<html><head></head><body><ion-navbar color="dark">
  <ion-title>
    Chat
  </ion-title>
</ion-navbar>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Mongo Chat</title>

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">

  <style>
    #messages{height: 300px;}
  </style>



<div class="container">
        <div class="row">
          <div class="col-md-6 offset-md-3 col-sm-12">
            <h1 class="text-center">
              Mongo Chat
              <button id="clear" class="btn btn-danger">Clear</button>
            </h1>
      
            <div id="status"></div>
      
            <div class="chat">
              <input type="text" id="username" class="form-control" placeholder="Enter name..">
              <br>
              <div class="card">
                <div id="messages" class="card-block">
      
                <div class="chat-message">Niall: Hello!</div><div class="chat-message">Sophia: Hey</div></div>
              </div>
              <br>
              <textarea id="textarea" class="form-control" placeholder="Enter message.."></textarea>
              <button id="submit" type="submit">Submit</button>
            </div>
          </div>
        </div>
      </div>



  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js"></script>
  <script>

        (function(){
          var element = function(id){
            return document.getElementById(id);
          }
          // Get Elements
          var status = element('status');
          var messages = element('messages');
          var submit = element('submit');
          var username = element('username');
          var clearBtn = element('clear');
          
          var statusDefault = status.textContent;
      
          var setStatus = function(s){
            // Set Status
            status.textContent = s;
      
            if(s !== statusDefault){
              var delay = setTimeout(function(){
                setStatus(statusDefault);
              }, 4000);
          
            }
          }
      
          // Connect to Socket.io
          var socket = io.connect('http://127.0.0.1:4000');
      
          // Check for connection
          if(socket !== undefined){
            console.log('Connected to Socket...');

            // Handle output
            socket.on('output', function (data) {

              if (data.length) {
                for (var x = 0; x < data.length; x++) {
                  var message = document.createElement('div');
                  message.setAttribute('class', 'chat-message');
                  message.textContent = data[x].name + ": " + data[x].message;
                  messages.appendChild(message);
                  messages.insertBefore(message, messages.lastChild);
                }
              }
            });
            socket.on('status', function(data){
              // get message status
              setStatus((typeof data === 'object')? data.message: data);

              if(data.clear){
                textarea.value = "";
              }
            });

            // Handle Input
            submit.addEventListener('click', function(event){
                // Emit to server input   
                            
                socket.emit('input', {name:username.value, message:textarea.value});

                event.preventDefault();
              

            })

            // Handle clear chat
            clearBtn.addEventListener('click', function(){
              socket.emit('clear');
            });

            // Clear Message
            socket.on('cleared', function(){
              messages.textContent = '';
            })

          }
          else{
            alert("Not connected");
          }

        })();
      </script>

</body></html>